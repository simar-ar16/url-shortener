<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Shortify | Shorten URLs</title>
  <link rel="stylesheet" href="/landing.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<!-- Responsive Navbar -->
<nav class="navbar navbar-expand-lg custom-navbar">
  <div class="container-fluid">
    <span class="navbar-brand text-white fw-bold">üîó Shortify</span>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse custom-collapse" id="navbarContent">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
        <% if (!locals.user) { %>
          <li class="nav-item"><a class="nav-link" href="#features">Features</a></li>
          <li class="nav-item"><a class="nav-link" href="/login">Login</a></li>
          <li class="nav-item"><a class="nav-link" href="/signup">Sign Up</a></li>
        <% } else { %>
          <li class="nav-item"><a class="nav-link" href="/home">Dashboard</a></li>
        <% } %> 
      </ul>
    </div>
  </div>
</nav>

<!-- Hero Section -->
<div class="container content-wrapper">
  <div class="info-card">
    <h2>Welcome to Shortify!</h2>
    <p>Shortify helps you convert long, messy URLs into clean, shareable links instantly.</p>
    <p>Use it without login, or create an account to track click analytics!</p>
    <p>Now with built-in QR code generation ‚Äî instantly create and download QR codes for your links.</p>
    <p>Safe, fast, and completely free.</p>
  </div>

  <div class="login-box">
    <h2>Paste Your Long URL</h2>
    <form action="/public" method="POST">
      <input type="text" name="fullURL" placeholder="https://example.com" required />
      <button type="submit">Generate Short Link</button>
    </form>

<% if (id) { %>
  <div class="d-flex align-items-center gap-2 mt-2">Short URL:
    <a href="/url/<%= id %>" target="_blank" class="short-url-link">
      <%= BASE_URL %>/url/<%= id %>
    </a>
    <button type="button" id="gen-qr-btn" class="btn btn-sm btn-danger">
      <i class="bi bi-qr-code"></i> Show QR
    </button>
  </div>
<% } %>


    <% if (error) { %>
      <div class="error-box"><%= error %></div>
    <% } %>

    <p style="margin-top: 15px;">Want to see click analytics? <a href="/login" style=" color: #05367f;">Login here</a></p>
  </div>
</div>

<div class="modal fade" id="qrModal" tabindex="-1" aria-labelledby="qrModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center p-4">
      <h5 class="modal-title mb-3" id="qrModalLabel">Your QR Code</h5>
      <div id="qr-img-container" class="mb-3"></div>
      <button id="download-btn" class="btn btn-success">
        <i class="bi bi-download"></i> Download QR
      </button>
    </div>
  </div>
</div>

<!-- Features -->
<section class="features-section" id="features">
  <h2>Why Choose Shortify?</h2>
  <div class="features">
    <div class="feature-card">
      <h3>üöÄ Fast</h3>
      <p>Generate short links instantly with a blazing fast backend.</p>
    </div>
    <div class="feature-card">
      <h3>üîê Secure</h3>
      <p>Your data is encrypted and stored safely. We value your privacy.</p>
    </div>
    <div class="feature-card">
      <h3>üìà Analytics</h3>
      <p>Real-time click tracking and traffic monitoring included.</p>
    </div>
  </div>
</section>

<!-- Footer -->
<footer>
  <p>&copy; 2025 Shortify. All rights reserved. |
    <a href="/privacy">Privacy</a> |
    <a href="/terms">Terms & Conditions</a> |
    <a href="/contact">Contact</a>
  </p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>\
<script>
document.getElementById('gen-qr-btn')?.addEventListener('click', async () => {
  const shortUrl = `<%= BASE_URL %>/url/<%= id %>`;
  const qrImgContainer = document.getElementById('qr-img-container');
  
  qrImgContainer.innerHTML = 'Generating...';

  try {
    const res = await fetch('/api/generate-qr', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ url: shortUrl })
    });
    const data = await res.json();
    if (data.error) throw new Error(data.error);

    qrImgContainer.innerHTML = `<img src="${data.qrDataUrl}" alt="QR Code" class="img-fluid" style="max-width:200px;">`;

    document.getElementById('download-btn').onclick = () => {
      const a = document.createElement('a');
      a.href = data.qrDataUrl;
      a.download = 'qrcode.png';
      a.click();
    };

    const qrModal = new bootstrap.Modal(document.getElementById('qrModal'));
    qrModal.show();

  } catch (err) {
    qrImgContainer.innerHTML = `<p class="text-danger">Error: ${err.message}</p>`;
  }
});
</script>

</body>
</html>
